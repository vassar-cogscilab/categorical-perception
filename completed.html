<!DOCTYPE html>
<html>
  <head>
    <title>Categorical Perception Experiment</title>
    <script src="jspsych-master/jspsych.js"></script>
    <script src="jspsych-master/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-master/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-master/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-master/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="js/serverComm.js"></script>
    <link rel="stylesheet" href="jspsych-master/css/jspsych.css"></link>
    <style>

    div.center {
      position: absolute;
      width:100vw;
      left: 0;
    }

    .oddball-stim {
      display: inline-block;
      padding: 10px;
      box-shadow: 0 4px 2px 0 rgba(0,0,0,0.5);
      border: 1px solid #ccc;
      margin: 0px 10px;
      background-color: white;
    }

    html, body { width: 100%; height: 100%; margin: 0;}
    #target { background-color: white; height: calc(100% - 50px);, width: 100%; margin: 0;}
    #progress { background-color: white; height: 50px; width 100vw; text-align:center;}

    #bar-container { width: 600px; height: 40px; background-color: white; border-color: black; border-width: 5px; border-radius: 5px; }
    #bar-fill { width: 0%; height: 40px; background-color: rgb(255,255,0); border-radius: 5px;}
    </style>
  </head>
  <body>

    <div id = "target"></div>
    <div id = "progress">
      <div id="bar-container">
        <div id="bar-fill"></div>
      </div>
    </div>

  </body>

  <script>

  //CONSTANTS
    var stim_width_height = 200;
    var stim_padding = 40;
    var min_dot_density = 100;
    var max_dot_density = 2000;
    var min_line_density = 30;
    var max_line_density = 550;
    var correct_sound = new sound("sound-effects/sound-correct.wav");
    var incorrect_sound = new sound("sound-effects/sound-incorrect.wav");
    var countdown_sound = new sound("sound-effects/peep.wav");
    // object constructor for sound effects
    function sound(src) {
      this.sound = document.createElement("audio");
      this.sound.src = src;
      this.sound.setAttribute("preload", "auto");
      this.sound.setAttribute("controls", "none");
      this.sound.style.display = "none";
      document.body.appendChild(this.sound);
      this.play = function(){
        this.sound.play();
      }
      this.stop = function(){
        this.sound.pause();
      }
    }

  //PHASE ONE
    var dot_distance = 0.8;
    var line_distance = 0.8;
    var dot_trials = 0;
    var line_trials = 0;
    var dot_reversals = 0;
    var line_reversals = 0;
    var dot_jnd = 0;
    var line_jnd = 0;

  //STAIRCASE
    var rel_be_distance = 0.33;
    var rel_wi1_distance = 0.33;
    var rel_wi2_distance = 0.33;
    var irr1_distance = 0.33;
    var irr2_distance = 0.33;
    var irr3_distance = 0.33;

    // adjusts the particular distance after every response
    function adjust_distance(distance, correct, test_part) {
      var adjustment = test_part == 'phase_one' ? 0.15 : 0.05;
      distance *= correct == true ? (1-adjustment) : (1+adjustment);
      if (test_part == 'ob_test' && distance > 0.33) {distance = 0.33}
      return distance;
    }

  //PARTICIPANT
    // determines if participant is in the experimental or control group
    var group = jsPsych.randomization.sampleWithoutReplacement(['experimental', 'control'], 1) [0];

    // determines which dimension is relevant throughout the experiment
    var relevant_dimension = jsPsych.randomization.sampleWithoutReplacement(['dots', 'lines'], 1) [0];

  //HELPERS
    // randomly determines which sunburst will be the correct answer in an odd-ball trial
    function randomize_correct() {
      return jsPsych.randomization.sampleWithoutReplacement(['1', '2', '3', '4'], 1)[0];
    }

    // array of pair_types for each trial in a given trial block
    var pair_types = [];

    // randomly samples a particular sunburst from the scene
    function randomize_sunburst() {
      return jsPsych.randomization.sampleWithoutReplacement([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], 1)[0];
    }

    // randomly generates true or false
    function boolean() {
      var boolean = jsPsych.randomization.sampleWithoutReplacement([true, false], 1)[0];
      return boolean;
    }

    // determines if the sunburst is a lif or a mep
    function lif_mep(sunburst) {
      if (sunburst <= 8) {var correct = 'L';}
      else {var correct = 'M';}
      return correct;
    }

    //randomly determines which pair to present of given pair type
    function which_pair(pair_type) {
      var pair;
      if (pair_type == 'be') {pair = jsPsych.randomization.sampleWithoutReplacement([5,6,7,8], 1)[0]}
      else if (pair_type == 'wi1') {pair = jsPsych.randomization.sampleWithoutReplacement([1,2,3,4], 1)[0]}
      else if (pair_type == 'wi2') {pair = jsPsych.randomization.sampleWithoutReplacement([9,10,11,12], 1)[0]}
      else if (pair_type == 'irr1') {pair = jsPsych.randomization.sampleWithoutReplacement([13,16,19,22], 1)[0]}
      else if (pair_type == 'irr2') {pair = jsPsych.randomization.sampleWithoutReplacement([14,17,20,23], 1)[0]}
      else if (pair_type == 'irr3') {pair = jsPsych.randomization.sampleWithoutReplacement([15,18,21,24], 1)[0]}
      return pair;
    }

    //determines which distance to use for given pair type
    function which_distance(pair_type) {
      var distance;
      if (pair_type == 'be') {distance = rel_be_distance}
      else if (pair_type == 'wi1') {distance = rel_wi1_distance}
      else if (pair_type == 'wi2') {distance = rel_wi2_distance}
      else if (pair_type == 'irr1') {distance = irr1_distance}
      else if (pair_type == 'irr2') {distance = irr2_distance}
      else if (pair_type == 'irr3') {distance = irr3_distance}
      return distance;
    }

    // rounds given number to given precision
    function round(value, precision) {
      if (precision < -4 && precision > 15)
          {throw new ArgumentOutOfRangeException("precision", "Must be and integer between -4 and 15")}
      if (precision >= 0) {return Math.round(value, precision)}
      else {
          precision = Math.pow(10, Math.abs(precision));
          value = value + (5 * precision / 10);
          return Math.round(value - (value % precision), 0);
      }
    }

    function small_sunburst(pair) {
      if (pair <= 12) {var sunburst = pair}
      else if (pair <= 15) {var sunburst = pair-12}
      else if (pair <= 18) {var sunburst = pair-11}
      else if (pair <= 21) {var sunburst = pair-10}
      else {var sunburst = pair-9}
      return sunburst;
    }

    function big_sunburst(pair) {
      if (pair <= 12) {var sunburst = pair+4}
      else if (pair <= 15) {var sunburst = pair-11}
      else if (pair <= 18) {var sunburst = pair-10}
      else if (pair <= 21) {var sunburst = pair-9}
      else {var sunburst = pair-8}
      return sunburst;
    }

    // returns x coordinate of a given sunburst
    function x_coordinate(sunburst) {
      var x_coord;
      if (sunburst <= 4) {x_coord = 0;}
      else if (sunburst >= 5 && sunburst <= 8) {x_coord = 1;}
      else if (sunburst >= 9 && sunburst <= 12) {x_coord = 2;}
      else {x_coord = 3;}
      return x_coord;
    }

    // returns y coordinate of a given sunburst
    function y_coordinate(sunburst) {
      var y_coord;
      if (sunburst % 4 == 1) {y_coord = 0;}
      else if (sunburst % 4 == 2) {y_coord = 1;}
      else if (sunburst % 4 == 3) {y_coord = 2;}
      else {y_coord = 3;}
      return y_coord;
    }

    // determines relevant dimension values for a given coordinate
    function rel_dim_val(x){
      var x_dim;
      if(x == 0){
        x_dim = 0.5 - (rel_be_distance/2) - rel_wi1_distance;
      } else if(x == 1) {
        x_dim = 0.5 - (rel_be_distance/2);
      } else if(x == 2) {
        x_dim = 0.5 + (rel_be_distance/2);
      } else {
        x_dim = 0.5 + (rel_be_distance/2) + rel_wi2_distance;
      }
      return x_dim;
    }

    // determines irrelevant dimension values for a given coordinate
    function irr_dim_val(y) {
      var y_dim;
      if(y == 0){
        y_dim = 0.5 - (irr2_distance/2) - irr3_distance;
      } else if(y == 1) {
        y_dim = 0.5 - (irr2_distance/2);
      } else if(y == 2) {
        y_dim = 0.5 + (irr2_distance/2);
      } else {
        y_dim = 0.5 + (irr2_distance/2) + irr1_distance;
      }
      return y_dim;
    }

    // generates single-item task stimuli
    function calculate_sunburst_values(sunburst) {
      var dimension = relevant_dimension;
      if (dimension == 'dots') {
        var x_dim = rel_dim_val(x_coordinate(sunburst));
        var y_dim = irr_dim_val(y_coordinate(sunburst));
        return generate_stim(x_dim, y_dim);
      } else {
        var x_dim = irr_dim_val(x_coordinate(sunburst));
        var y_dim = rel_dim_val(y_coordinate(sunburst));
        return generate_stim(x_dim, y_dim);
      }
    }

    // generates oddball task stimuli
    function calculate_pair_values(pair, correct) {
      var dimension = relevant_dimension;
      var bool = boolean();
      if (bool) {
        var same_ball = small_sunburst(pair);
        var sx_coord = x_coordinate(same_ball);
        var sy_coord = y_coordinate(same_ball);
        var odd_ball = big_sunburst(pair);
        var ox_coord = x_coordinate(odd_ball);
        var oy_coord = y_coordinate(odd_ball);
      } else {
        var odd_ball = small_sunburst(pair);
        var ox_coord = x_coordinate(odd_ball);
        var oy_coord = y_coordinate(odd_ball);
        var same_ball = big_sunburst(pair);
        var sx_coord = x_coordinate(same_ball);
        var sy_coord = y_coordinate(same_ball);
      }
      if (dimension == 'dots') {
        var ox_dim = rel_dim_val(ox_coord);
        var oy_dim = irr_dim_val(oy_coord);
        var sx_dim = rel_dim_val(sx_coord);
        var sy_dim = irr_dim_val(sy_coord);
      } else {
        var ox_dim = irr_dim_val(ox_coord);
        var oy_dim = rel_dim_val(oy_coord);
        var sx_dim = irr_dim_val(sx_coord);
        var sy_dim = rel_dim_val(sy_coord);
      }
      var set = generate_set(sx_dim, sy_dim, ox_dim, oy_dim, correct)
      return set;
    }

    // depicts the set of stimuli in the scene
    function generate_set(same_dot, same_line, odd_dot, odd_line, correct) {
      var html = '<div style="position: relative; width:'+((stim_width_height+stim_padding)*4 + stim_padding)+'px; height:'+(stim_width_height+stim_padding)+'px;">';
      if (correct == '1'){
        html += '<div class="oddball-stim ex1">'+generate_stim(odd_dot, odd_line)+'</div>'+
          '<div class="oddball-stim ex2">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex3">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex4">'+generate_stim(same_dot, same_line)+'</div>';
      } else if (correct == '2') {
        html += '<div class="oddball-stim ex1">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex2">'+generate_stim(odd_dot, odd_line)+'</div>'+
          '<div class="oddball-stim ex3">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex4">'+generate_stim(same_dot, same_line)+'</div>';
      } else if (correct == '3') {
        html += '<div class="oddball-stim ex1">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex2">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex3">'+generate_stim(odd_dot, odd_line)+'</div>'+
          '<div class="oddball-stim ex4">'+generate_stim(same_dot, same_line)+'</div>';
      } else {
        html += '<div class="oddball-stim ex1">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex2">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex3">'+generate_stim(same_dot, same_line)+'</div>'+
          '<div class="oddball-stim ex4">'+generate_stim(odd_dot, odd_line)+'</div>';
      }
      html += '</div>';
      return html;
    }

    // draws individual sunburst
    function generate_stim_svg(dot_dim, line_dim) {
        // params
        var w = stim_width_height;
        var r = stim_width_height/4;
        var x = w / 2;
        var y = w / 2;
        var circle_r = stim_width_height / 200;
        var minLineLength = 10;
        var dot_density = min_dot_density + (max_dot_density-min_dot_density)*dot_dim;
        var line_density = min_line_density + (max_line_density-min_line_density)*line_dim;

        // svg string
        var str = '<svg xmlns="http://www.w3.org/2000/svg" width="' + w + '" height="' + w + '">'

        //Code for drawing the lines that come out of the circle.
        //Each line starts in the center of the circle and is drawn outward
        for (var i = 0; i < line_density; i++) {
          var angle = Math.random() * Math.PI / 2;
          var lineLength = r + minLineLength + (r - minLineLength) * Math.random();
          var x2 = Math.cos(angle) * lineLength;
          var y2 = Math.sin(angle) * lineLength;
          if (Math.random() < 0.5) {
            x2 = -x2;
          }
          if (Math.random() < 0.5) {
            y2 = -y2;
          }
          x2 = x + x2;
          y2 = y + y2;
          str += '<line x1="' + x + '" y1="' + y + '" x2="' + x2 + '" y2="' + y2 + '" style="stroke:rgb(65,105,225); stroke-width:1;" />';
        }

        // draw circle
        str += '<circle cx="' + x + '" cy="' + y + '" r="' + r + '" style="stroke:rgb(65,105,225); stroke-width:2; fill: rgb(255,255,255);"/>'

        //Code for creating and dispersing the dots
        for (var j = 0; j < dot_density; j++) {
          do {
            var x2 = Math.random() * 2 * r + x - r;
            var y2 = Math.random() * 2 * r + y - r;
          } while ((Math.pow(x - x2, 2) + Math.pow(y - y2, 2)) > Math.pow(r - circle_r - 2, 2));
          str += '<circle cx="' + x2 + '" cy="' + y2 + '" r="' + circle_r + '" style="fill:rgb(65,105,225);" />';
        }

        str += "</svg>";

        return str;
    }

    function generate_stim(dot_dim, line_dim) {
        // params
        var w = stim_width_height;
        var r = stim_width_height/4;
        var x = w / 2;
        var y = w / 2;
        var circle_r = stim_width_height / 200;
        var minLineLength = 10;
        var dot_density = min_dot_density + (max_dot_density-min_dot_density)*dot_dim;
        var line_density = min_line_density + (max_line_density-min_line_density)*line_dim;

        var canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = w;
        var ctx = canvas.getContext('2d');
        ctx.strokeStyle = "#4169e1"

        //Code for drawing the lines that come out of the circle.
        //Each line starts in the center of the circle and is drawn outward
        for (var i = 0; i < line_density; i++) {
          var angle = Math.random() * Math.PI / 2;
          var lineLength = r + minLineLength + (r - minLineLength) * Math.random();
          var x2 = Math.cos(angle) * lineLength;
          var y2 = Math.sin(angle) * lineLength;
          if (Math.random() < 0.5) {
            x2 = -x2;
          }
          if (Math.random() < 0.5) {
            y2 = -y2;
          }
          x2 = x + x2;
          y2 = y + y2;
          //str += '<line x1="' + x + '" y1="' + y + '" x2="' + x2 + '" y2="' + y2 + '" style="stroke:rgb(65,105,225); stroke-width:1;" />';
          ctx.beginPath();
          ctx.moveTo(x,y);
          ctx.lineTo(x2,y2);
          ctx.stroke();
        }

        // draw circle
        ctx.fillStyle="#FFFFFF";
        ctx.beginPath();
        ctx.arc(x,y,r,0,2*Math.PI);
        ctx.fill();
        ctx.stroke();
        //Code for creating and dispersing the dots
        ctx.fillStyle="#4169e1";
        for (var j = 0; j < dot_density; j++) {
          do {
            var x2 = Math.random() * 2 * r + x - r;
            var y2 = Math.random() * 2 * r + y - r;
          } while ((Math.pow(x - x2, 2) + Math.pow(y - y2, 2)) > Math.pow(r - circle_r - 2, 2));
          ctx.beginPath();
          ctx.arc(x2,y2,circle_r,0,2*Math.PI);
          ctx.fill();
        }
      var html = "<img src='"+canvas.toDataURL()+"'></img>";
      return html;
    }

    function category_feedback() {
      var correct_response = jsPsych.data.get().last(1).values()[0].correct_response;
      if (correct_response == 'L') {var feedback = 'Lif'}
      else {var feedback = 'Mep'}
      return feedback;
    }

    function too_slow() {
      return jsPsych.randomization.sampleWithoutReplacement(['Snooze ya lose!', 'Oops!', 'Cmon Grandma!'], 1)[0]
    }

  //UNIVERSALS
    var pause = {
      type: 'html-keyboard-response',
      stimulus: function () {
        if (jsPsych.data.get().last(1).values()[0].test_part == 'instructions') {return ''}
        else if (jsPsych.data.get().last(2).values()[0].key_press != null) {return ''}
        else {return "<p>Still with us? Press any key to continue. </p>"}
      },
      choices: function () {
        if (jsPsych.data.get().last(1).values()[0].test_part == 'instructions') {return jsPsych.NO_KEYS}
        if (jsPsych.data.get().last(2).values()[0].key_press != null) {return jsPsych.NO_KEYS}
      },
      trial_duration: function () {
        if (jsPsych.data.get().last(1).values()[0].test_part == 'instructions') {return 250}
        if (jsPsych.data.get().last(2).values()[0].key_press != null) {return 250}
      },
      data: {test_part: 'pause'}
    }

    var three = {
      type: 'html-keyboard-response',
      stimulus: "<div class='center';'><img src='jspsych-master/img/three.png'></img>",
      trial_duration: 1000,
      on_start: function () {countdown_sound.play()},
      choices: jsPsych.NO_KEYS,
      data: {test_part: 'instructions'}
    }

    var two = {
      type: 'html-keyboard-response',
      stimulus: "<div class='center';'><img src='jspsych-master/img/two.png'></img>",
      trial_duration: 1000,
      on_start: function () {countdown_sound.play()},
      choices: jsPsych.NO_KEYS,
      data: {test_part: 'instructions'}
    }

    var one = {
      type: 'html-keyboard-response',
      stimulus: "<div class='center';'><img src='jspsych-master/img/one.png'></img>",
      trial_duration: 1000,
      on_start: function () {countdown_sound.play()},
      choices: jsPsych.NO_KEYS,
      data: {test_part: 'instructions'}
    }

    var countdown = {
      timeline: [three, two, one],
      data: {test_part: 'instructions'},
    }

  //TRIALS
    var p1_test = {
      type: 'html-keyboard-response',
      stimulus: '',
      choices: ['1', '2', '3', '4'],
      trial_duration: 4000,
      timeline_variables: [
        {pair: 'dots'},
        {pair: 'lines'},
      ],
      sample: {type: 'with-replacement', size: 1},
      on_start: function(trial) {
        var bool1 = boolean();
        var bool2 = boolean();
        var dl = bool1 == true ? 'dots' : 'lines';
        var dot_dist = dot_distance;
        var line_dist = line_distance;
        var correct = randomize_correct();
        if (dl == 'dots') /* pair on dot dimension */ {
          var small_dot = Math.random()*(1.0-dot_distance);
          var big_dot = small_dot+dot_distance;
          var lines = Math.random();
          var ox_dim = bool2 == true ? small_dot : big_dot;
          var oy_dim = lines;
          var sx_dim = bool2 == true ? big_dot : small_dot;
          var sy_dim = lines;
        } else /* pair on line dimension*/{
          var small_line = Math.random()*(1.0-line_distance);
          var big_line = small_line+line_distance;
          var dots = Math.random();
          var ox_dim = dots;
          var oy_dim = bool2 == true ? small_line: big_line;
          var sx_dim = dots;
          var sy_dim = bool2 == true ? big_line : small_line;
        }
        var set = generate_set(sx_dim, sy_dim, ox_dim, oy_dim, correct);
        var question = '<div class="center"><p>Choose the odd-ball</p></div>';
        var stimulus = set + question;
        trial.stimulus = stimulus;
        trial.data = {
          test_part: 'phase_one',
          correct_response: correct,
          stimulus: set,
          dot_dist: dot_dist,
          line_dist: line_dist,
          ox_dim: ox_dim,
          oy_dim: oy_dim,
          sx_dim: sx_dim,
          sy_dim: sy_dim,
          pair_type: dl,
          reversal: false,
          rt: 0,
        }
      },
      on_finish: function(data) {
        data.rt = jsPsych.data.get().select('rt');
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
        if (data.pair_type == 'dots') {
          dot_distance = adjust_distance(dot_distance, data.correct, data.test_part);
          dot_trials += 1;
          var last_dot;
          if (dot_trials > 1) {last_dot = jsPsych.data.get().filter({test_part: 'phase_one', pair_type: 'dots'}).last(2).values()[0].correct}
          if(dot_trials > 1 && data.correct != last_dot) {data.reversal = true}
          if (data.reversal == true) {dot_reversals +=1}
          if (dot_reversals == 4) {dot_jnd = data.dot_dist}
          else if (dot_reversals > 4) {dot_jnd *= (dot_reversals-4)*data.dot_dist/(dot_reversals+1)}
        } else /* data.pair_type == 'lines' */{
          line_distance = adjust_distance(line_distance, data.correct, data.test_part);
          line_trials +=1;
          var last_line;
          if (line_trials > 1) {last_line = jsPsych.data.get().filter({test_part: 'phase_one', pair_type: 'lines'}).last(2).values()[0].correct}
          if(line_trials > 1 && data.correct != last_line) {data.reversal = true}
          if (data.reversal == true) {line_reversals +=1}
          if (line_reversals == 4) {line_jnd = data.line_dist}
          else if (line_reversals > 4) {line_jnd = line_jnd*(line_reversals-4)*data.line_dist/(line_reversals+1)}
        }
      },
    }

    var ob_rel = {
      type: "html-keyboard-response",
      stimulus: '',
      choices: ['1', '2', '3', '4'],
      //trial_duration: 4000,
      on_start: function(trial) {
        var correct = randomize_correct();
        var question = '<div class="center"><p>Choose the odd-ball</p></div>';
        if (relevant_dimension=='dots') {
          if (boolean()) {var set = generate_set(0.2,0.2,0.8,0.2,correct)}
          else {var set = generate_set(0.8,0.8,0.2,0.8,correct)}
        } else /* relevant_dimension == 'lines' */ {
          if (boolean()) {var set = generate_set(0.2,0.2,0.2,0.8,correct)}
          else {var set = generate_set(0.8,0.8,0.8,0.2,correct)}
        }
        var stimulus = set + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'ob_rel', correct_response: correct, stimulus: set}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var ob_irr = {
      type: "html-keyboard-response",
      stimulus: '',
      choices: ['1', '2', '3', '4'],
      //trial_duration: 4000,
      on_start: function(trial) {
        var correct = randomize_correct();
        var question = '<div class="center"><p>Choose the odd-ball</p></div>';
        if (relevant_dimension=='lines') {
          if (boolean()) {var set = generate_set(0.2,0.2,0.8,0.2,correct)}
          else {var set = generate_set(0.8,0.8,0.2,0.8,correct)}
        } else /* relevant_dimension == 'dots' */ {
          if (boolean()) {var set = generate_set(0.2,0.2,0.2,0.8,correct)}
          else {var set = generate_set(0.8,0.8,0.8,0.2,correct)}
        }
        var stimulus = set + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'ob_rel', correct_response: correct, stimulus: set}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var ct_tig = {
      type: "html-keyboard-response",
      stimulus: '',
      //trial_duration: 4000,
      choices: ['L', 'M',],
      on_start: function(trial) {
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(2) + '</div>';
        var correct = 'L';
        var question = '<div class="center"><p>"Is this a Lif (L) or a Mep (M)?"</p></div>';
        var stimulus = sunburst + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'ct_tig', correct_response: correct, stimulus: sunburst}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var ct_fep = {
      type: "html-keyboard-response",
      stimulus: '',
      //trial_duration: 4000,
      choices: ['L', 'M',],
      on_start: function(trial) {
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(14) + '</div>';
        var correct = 'M';
        var question = '<div class="center"><p>"Is this a Lif (L) or a Mep (M)?"</p></div>';
        var stimulus = sunburst + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'ct_tig', correct_response: correct, stimulus: sunburst}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var nj_dots = {
      type: "html-keyboard-response",
      stimulus: '',
      //trial_duration: 4000,
      choices: ['M', 'L',],
      on_start: function(trial) {
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(1) + '</div>';
        var correct = 'L';
        var question = '<div class="center"><p>"2000 dots?"</p></div>';
        var stimulus = sunburst + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'nj_dots', correct_response: correct, stimulus: sunburst}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var nj_lines = {
      type: "html-keyboard-response",
      stimulus: '',
      //trial_duration: 4000,
      choices: ['M', 'L'],
      on_start: function(trial) {
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(16) + '</div>';
        var correct = 'M';
        var question = '<div class="center"><p>"50 lines?"</p></div>';
        var stimulus = sunburst + question;
        trial.stimulus = stimulus;
        trial.data = {test_part: 'nj_lines', correct_response: correct, stimulus: sunburst}
      },
      on_finish: function(data) {
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var ob_test = {
      type: "html-keyboard-response",
      stimulus: '',
      choices: ['1', '2', '3', '4'],
      trial_duration: 4000,
      on_start: function(trial) {
        if(pair_types.length == 0){
          pair_types = jsPsych.randomization.shuffle(['be','wi1','wi2','irr1','irr2','irr3']);
        }
        var correct = randomize_correct();
        var pair_type = pair_types.pop();
        var pair = which_pair(pair_type);
        var distance = which_distance(pair_type);
        var question = '<div class="center"><p>Choose the odd-ball</p></div>';
        var set = calculate_pair_values(pair, correct);
        var stimulus = set + question;
        trial.stimulus = stimulus;
        trial.data = {
          test_part: 'ob_test',
          correct_response: correct,
          stimulus: set,
          pair_type: pair_type,
          distance: distance,
          rt: 0,
        }
      },
      on_finish: function(data) {
        data.rt = jsPsych.data.get().select('rt');
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
        if (data.pair_type == 'be') {
          rel_be_distance = adjust_distance(rel_be_distance, data.correct, data.test_part);
        } else if (data.pair_type == 'wi1') {
          rel_wi1_distance = adjust_distance(rel_wi1_distance, data.correct, data.test_part);
        } else if (data.pair_type == 'wi2') {
          rel_wi2_distance = adjust_distance(rel_wi1_distance, data.correct, data.test_part);
        } else if (data.pair_type == 'irr1') {
          irr1_distance = adjust_distance(irr1_distance, data.correct, data.test_part);
        } else if (data.pair_type == 'irr2') {
          irr2_distance = adjust_distance(irr2_distance, data.correct, data.test_part);
        } else {
          irr3_distance = adjust_distance(irr3_distance, data.correct, data.test_part);
        }
      },
    }

    var ct_test = {
      type: "html-keyboard-response",
      stimulus: '',
      trial_duration: 4000,
      choices: ['L', 'M',],
      on_start: function(trial) {
        var random = randomize_sunburst();
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(random) + '</div>';
        var correct_response = lif_mep(random);
        var question = '<div class="center"><p>"Is this a Lif (L) or a Mep (M)?"</p></div>';
        var stimulus = sunburst + question;
        trial.stimulus = stimulus;
        trial.data = {
          test_part: 'ct_test',
          correct_response: correct_response,
          stimulus: sunburst,
          rt: 0,
        }
      },
      on_finish: function(data) {
        data.rt = jsPsych.data.get().select('rt');
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var nj_test = {
      type: "html-keyboard-response",
      stimulus: '',
      trial_duration: 4000,
      choices: ['M', 'L',],
      on_start: function(trial) {
        var dimension = relevant_dimension;
        var pair = Math.round(Math.random()*24);
        var bool = boolean();
        var ml = bool == true ? "more" : "less";
        var dl = pair <= 12 ? "dots" : "lines";
        //stimulus
        var sb = ml == "less" ? small_sunburst(pair) : big_sunburst(pair);
        var sunburst = '<div class="oddball-stim">' + calculate_sunburst_values(sb) + '</div>';
        var x_dim = dimension == 'dots' ? rel_dim_val(x_coordinate(sb)) : irr_dim_val(x_coordinate(sb));
        var y_dim = dimension == 'lines' ? rel_dim_val(y_coordinate(sb)) : irr_dim_val(y_coordinate(sb));
        var dots = min_dot_density + (max_dot_density-min_dot_density)*x_dim;
        var lines = min_line_density + (max_line_density-min_line_density)*y_dim;
        //question
        var q = ml == "less" ? big_sunburst(pair) : small_sunburst(pair);
        if (dl == 'dots') {var num_dim = dimension == "dots" ? rel_dim_val(x_coordinate(q)) : irr_dim_val(x_coordinate(q))}
        else {var num_dim = dimension == "dots" ? rel_dim_val(y_coordinate(q)) : irr_dim_val(y_coordinate(q));}
        var number = dl == "dots" ? (min_dot_density + (max_dot_density-min_dot_density)*num_dim) : (min_line_density + (max_line_density-min_line_density)*num_dim);
        var precision = dl == "dots" ? -2 : -1;
        number = round(number, precision);
        var question = '<div class="center">' + "<p>" + number + " " + dl + "?</p>" + '</div>';
        //
        var stimulus = sunburst + question;
        var correct_response = ml == "more" ? 'M' : 'L';
        trial.data = {
          test_part: 'test',
          correct_response: correct_response,
          stimulus: sunburst,
          dot_density: x_dim,
          line_density: y_dim,
          dot_count: dots,
          line_count: lines,
          rt: 0,
        }
        trial.stimulus = stimulus;
      },
      on_finish: function(data) {
        data.rt = jsPsych.data.get().select('rt');
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var ob_feedback = {
      type: "html-keyboard-response",
      stimulus: function() {
        var lastCorrect = jsPsych.data.get().last(1).values()[0].correct;
        if (lastCorrect) {correct_sound.play()}
        else {incorrect_sound.play()}
        var html = "<style>";
        var stimulus = jsPsych.data.get().last(1).values()[0].stimulus;
        var correct_response = jsPsych.data.get().last(1).values()[0].correct_response;
        var actualResponse = jsPsych.data.get().last(1).values()[0].key_press - 48;
        html += ".ex"+correct_response+" { border: 11px solid limegreen; padding: 0;} ";
        if(lastCorrect == true) {
          html += "</style>"
          html += "<p style='position:absolute; width: 100%; left: 0;'>Correct!</p>"
        } else if (jsPsych.data.get().last(1).values()[0].key_press == null) {
          html += ".ex"+actualResponse+" { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>" + too_slow();
          return html;
        } else {
          html += ".ex"+actualResponse+" { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += "<p style='position:absolute; width: 100%; left: 0;'>Incorrect!</p>"
        }
        stimulus += html;
        return stimulus;
      },
      choices: jsPsych.NO_KEYS,
      trial_duration: 750,
    }

    var ct_feedback = {
      type: "html-keyboard-response",
      stimulus: function () {
        var lastCorrect = jsPsych.data.get().last(1).values()[0].correct;
        if (lastCorrect) {correct_sound.play()}
        else {incorrect_sound.play()}
        var html = "<style>"
        if (lastCorrect == true) {
          html += ".oddball-stim { border: 11px solid limegreen; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>Correct, this is a " +
            category_feedback() + "!</p>"
          return html;
        } else if (jsPsych.data.get().last(1).values()[0].key_press == null) {
          html += ".oddball-stim { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>" + too_slow() + " This is a " +
            category_feedback();
          return html;
        }
        else {
          html += ".oddball-stim { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>Incorrect, this is a " +
            category_feedback() + "!</p>"
          return html;
        }
      },
      choices: jsPsych.NO_KEYS,
      trial_duration: 750,
    }

    var nj_feedback = {
      type: "html-keyboard-response",
      stimulus: function () {
        var lastCorrect = jsPsych.data.get().last(1).values()[0].correct;
        if (lastCorrect) {correct_sound.play()}
        else {incorrect_sound.play()}
        var html = "<style>"
        if (lastCorrect == true) {
          html += ".oddball-stim { border: 11px solid limegreen; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>Correct!</p>"
          return html;
        } else if (jsPsych.data.get().last(1).values()[0].key_press == null) {
          html += ".oddball-stim { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>" + too_slow();
          return html;
        }
        else {
          html += ".oddball-stim { border: 11px solid red; padding: 0;} ";
          html += "</style>"
          html += jsPsych.data.get().last(1).values()[0].stimulus +
            "<p style='position:absolute; width: 100%; left: 0;'>Incorrect!</p>"
          return html;
        }
      },
      choices: jsPsych.NO_KEYS,
      trial_duration: 750,
    }

  //TIMELINE
    var timeline = [];

  //INSTRUCTIONS
    var consent_form = {
      type: "html-button-response",
      stimulus: "<p>This experiment is being conducted by researchers at Vassar College. </p> \
      <p>It consists of several tasks, each of which involves viewing various stimuli </p> \
      <p>and making simple judgments about them. The study takes approximately 30 minutes to complete. </p> \
      <p>Participation poses minimal risk, meaning the risk is no greater than that of normal, everyday activities. </p> \
      <p>Your anonymous data, identified only by your Prolific worker ID, will be used for research purposes. </p> \
      <p>For your participation, you will receive a small payment of $__ upon completion of the experiment. </p> \
      <p>You are free to stop the experiment by closing your browser window at any time. </p> \
      <p>If you have any questions, you can contact: </p> \
      <p><strong>Prof. Jan Andrews</strong> at <link>andrewsj@vassar.edu</link>, or <strong>Prof. Josh de Leeuw</strong> at <link>jdeleeuw@vassar.edu</link></p> \
      <p>By clicking 'I agree,' you affirm that you are at least 18 years of age, which is the minimum age to participate in this study.</p> ",
      choices: ['I agree'],
    }

    var overview = {
      type: "html-keyboard-response",
      choices: ["enter"],
      stimulus: "<p>Welcome to the experiment! </p> \
      <p>This study has two parts: the first, an odd-one-out task, and the second, the odd-one-out task plus a judgement task. </p> \
      <p>Both involve making speeded perceptual judgments about presented stimuli. We will acquaint you with each of the tasks before you begin.</p> \
      <p>As you get better at the tasks, they will become increasingly difficult! You will have periodic opportunities during the experiment to take a short break.</p> \
      <p>Please ensure that you are able to devote your full attention to the tasks and do your best to answer correctly.</p> \
      <p>If you are unable to do so, we strongly encourage you not to continue with the experiment. </p> \
      <p>Please make sure your sound volume is set at a comfortable level and close all other browser windows.</p> \
      <p>Do you wish to proceed? If so, press ENTER to continue! (You may need to click the screen first)</p> \
      <p>If you do not want to complete the experiment, please close your browser window. </p>",
    }

    var ob_instructions = {
      type: "html-keyboard-response",
      choices: '1',
      stimulus: "In this first task, you will see four sunbursts. Use the number keys on the top left of your keyboard.<p> \
      <p>If the <strong>first</strong> star from the left is the odd one out, press <strong>1</strong>. If the <strong>second</strong> star from the left is the odd one out, press <strong>2</strong>. </p> \
      <p>If the <strong>third</strong> star from the left is the odd one out, press <strong>3</strong>. If the <strong>fourth</strong> star from the left is the odd one out, press <strong>4</strong>. </p> \
      <p><div style='float: left;'><img src='jspsych-master/img/example_ob.png'></img></p> \
      <p class='small'> ex. <strong>Press 1</strong> to continue</p></div>",
      data: {test_part: 'instructions'}
    };

    var ob_instructions_pt2 = {
      type: "html-keyboard-response",
      stimulus: "<p> On each trial you will have up to <strong>4 seconds</strong> to enter your response before moving on to the next trial. Please do your best to respond within that time!</p> \
      <p>After you respond, you will receive feedback as to whether your response was correct, indicated by a green box (for correct) or a red box (for incorrect).</p> \
      <p>You are now ready to begin the first part of the experiment! Press any key to proceed. </p>",
      data: {test_part: 'instructions'}
    };

    var ct_instructions = {
      type: "html-keyboard-response",
      stimulus: "In this second phase of the experiment, odd-one-out trials like the ones you just completed will alternate with another task.</p> \
      <p>For this new task, you’ll be asked to identify two different kinds of sunbursts one at a time and you’ll be asked, <em>Is this a <strong>Lif (L)</strong> or a <strong>Mep (M)</strong>?</em></p> \
      <p><div style='float: left;'><img src='jspsych-master/img/example_ct.png'></img></p> \
    	<p>To indicate that the sunburst is a <strong>Lif</strong>, <em>press <strong>L</strong></em> on the keyboard. </p> \
    	<p>To indicate that the sunburst is a <strong>Mep</strong>, <em>press <strong>M</strong></em> on the keyboard. </p> \
      <p class='small'> ex. <strong>Press L</strong> to continue</p></div></p> \
      <p>After you respond, you’ll receive feedback as to whether your response was correct.</p> \
      <p>Initially you'll need to guess which sunbursts are which, but you’ll eventually learn to distinguish the two.</p> \
      <p>Press any key to continue.</p>",
      data: {test_part: 'instructions'}
    };

    var nj_instructions = {
      type: "html-keyboard-response",
      stimulus: "In this second phase of the experiment, odd-one-out trials like the ones you just completed will alternate with another task.</p> \
      <p>For this new task, you’ll be asked about the relative amount of dots or lines on a particular sunburst.</p> \
      <p>Each will be presented one at a time and you’ll be asked to respond to questions like, <em>400 lines?</em></p> \
      <p><div class='center';'><img src='jspsych-master/img/example_nj.png'></img></p> \
      <p>To indicate that there are <strong>more</strong> than the stated amount, <em>press <strong>M</strong></em> on the keyboard. </p> \
      <p>To indicate that there are <strong>less</strong> than the stated amount, <em>press <strong>L</strong></em> on the keyboard. </p> \
      <p>After you respond, you’ll receive feedback as to whether your response was correct.</p> \
      <p>It may sometimes be difficult to make judgments about the amount of dots or lines, but just try your best to answer correctly.</p> \
      <p>Press any key to continue.</p>",
      data: {test_part: 'instructions'}
    };

    var last_remarks = {
      type: "html-keyboard-response",
      stimulus: "<p>We recommend you use your <strong>left</strong> hand for the first task<strong>(1, 2, 3, 4)</strong> and your <strong>right</strong> hand for the second task<strong>(L, M)</strong>.</p> \
      <p>Just like before, you will have up to <strong>4 seconds</strong> to enter your response, </p> \
      <p>and after that it will move on to the next trial, so please do your best to respond within that time!</p> \
      <p>During this next part of the experiment, a bar will appear at the bottom of the screen </p> \
      <p>that will get longer when you succeed as the tasks get more difficult (Try to get it to be as long as you can!).</p> \
      <p>Okay, you’re finally ready to start the second part of the experiment! Press any key to proceed.</p>",
      data: {test_part: 'instructions'}
    };

  //PHASE ONE
    var p1_instructions = {
      timeline: [consent_form, overview, ob_instructions, ob_instructions_pt2, countdown],
      repetitions: 1,
      data: {test_part: 'p1'}
    }
    timeline.push(p1_instructions)

    var p1 = {
      timeline: [pause, p1_test, ob_feedback],
      repetitions: 1,
      data: {test_part: 'p1', trial_count: 0},
      loop_function: function(data) {
      if ((dot_reversals >= 8 && line_reversals >= 8) || (dot_trials + line_trials) >= 80) {
        /*if (relevant_dimension == 'dots') {
          if (dot_jnd != 0) {
            rel_be_distance = dot_jnd;
            rel_wi1_distance = dot_jnd;
            rel_wi2_distance = dot_jnd;
          }
          if (line_jnd != 0) {
            irr1_distance = line_jnd;
            irr2_distance = line_jnd;
            irr3_distance = line_jnd;
          }
        } else {
          if (line_jnd != 0) {
            rel_be_distance = line_jnd;
            rel_wi1_distance = line_jnd;
            rel_wi2_distance = line_jnd;
          }
          if (dot_jnd != 0) {
            irr1_distance = dot_jnd;
            irr2_distance = dot_jnd;
            irr3_distance = dot_jnd;
          }
        }*/
        return false;
      } else {return true}
      },
    }
    timeline.push(p1)

    var post_p1 = {
      type: "html-keyboard-response",
      stimulus: "<p><img src='jspsych-master/img/super.gif'></img></p>" +
      "<p>Excellent work back there! You've completed phase one. Press any key to continue on to phase two.</p>",
    }
    timeline.push(post_p1)

  //PHASE TWO
    var p2_instructions = {
      timeline: group == 'experimental' ? [ct_instructions, last_remarks, countdown] : [nj_instructions, last_remarks, countdown],
      data: {test_part: 'instructions'},
    }
    timeline.push(p2_instructions)

    var ob_task = {
      timeline: [pause, ob_test, ob_feedback],
      repetitions: 1,
    }

    var ct_task = {
      timeline: [pause, ct_test, ct_feedback],
      repetitions: 1,
    }

    var nj_task = {
      timeline: [pause, nj_test, nj_feedback],
      repetitions: 1,
    }

    // alternating between oddball & single-item tasks
    var trial_block = {
      timeline: group == 'experimental' ? [ob_task, ct_task] : [ob_task, nj_task],
      repetitions: 6,
    }

    var progress_update = {
      type: 'html-keyboard-response',
      stimulus: '',
      trial_duration: 100,
      choices: jsPsych.NO_KEYS,
      on_start: function () {
        var dist_avg = (rel_be_distance + rel_wi1_distance + rel_wi2_distance + irr1_distance + irr2_distance + irr3_distance) / 6;
        var dist_total = dist_avg / 0.33;
        var orange = Math.round(dist_total*255);
        var progress = 1 - dist_total;
        var bar_fill = progress * 100;
        document.querySelector('#bar-fill').style.width = bar_fill + '%';
        document.querySelector('#bar-fill').style.backgroundColor = 'rgb(255,'+orange+',0)';
      },
      data: {test_part: 'instructions'}
    }

    var quarter = {
      timeline: [trial_block, progress_update],
      repetitions: 2,
    }

    var break1 = {
      type: 'html-keyboard-response',
      stimulus: function() {
        var stim = "<p><img src='jspsych-master/img/beach1.gif'></img></p>";
        var msg = "Here's your first opportunity to take a break and relax your eyes. Press any key to resume the experiment.";
        var stimulus = stim + msg;
        return stimulus;
      }
    }

    var break2 = {
      type: 'html-keyboard-response',
      stimulus: function() {
        var stim = "<p><img src='jspsych-master/img/hot_sun.gif'></img></p>";
        var msg = "Phew! You're on fire, keep up the good work. Press any key to resume the experiment.";
        var stimulus = stim + msg;
        return stimulus;
      }
    }

    var break3 = {
      type: 'html-keyboard-response',
      stimulus: function() {
        var stim = "<p><img src='jspsych-master/img/beach2.gif'></img></p>";
        var msg = "You're almost there! Press any key to resume the experiment.";
        var stimulus = stim + msg;
        return stimulus;
      }
    }

    var p2 = {
      timeline: [quarter, break1, quarter, break2, quarter, break3, quarter]
    }
    timeline.push(p2);

    var survey = {
      type: "survey-text",
      preamble: "<p>Please use this space to provide feedback on the experiment, such as:</p>",
      button_label: ["continue"],
      questions: [
        {prompt: "Were there any technical problems?"},
        {prompt: "Were the instructions clear?"},
        {prompt: "Was 4 seconds long enough to respond?"},
        {prompt: "Was it somewhat fun?"},
        {prompt: "Please indicate if you have been exposed to the stimuli before."},
        {prompt: "Anything else you’d like to share."},
      ],
    }
    timeline.push(survey);

    var debrief = {
      type: 'html-keyboard-response',
      stimulus: 'this will be the debrief.',
      on_start: function(){
        serverComm.save_data(jsPsych.data.get().ignore('stimulus').values());
      }
    }
    timeline.push(debrief);

    /* post-experiment debrief */
    var debrief_block = {
      type: "html-keyboard-response",
      stimulus: function() {
        var ob_trials = jsPsych.data.get().filter({test_part: 'ob_test'});
        var ob_correct_trials = ob_trials.filter({correct: true});
        var ob_accuracy = Math.round(ob_correct_trials.count() / ob_trials.count() * 100);
        var ob_rt = Math.round(ob_correct_trials.select('rt').mean());
        if (group == 'experimental') {
          var ct_trials = jsPsych.data.get().filter({test_part: 'ct_test'});
          var ct_correct_trials = ct_trials.filter({correct: true});
          var ct_accuracy = Math.round(ct_correct_trials.count() / ct_trials.count() * 100);
          var ct_rt = Math.round(ct_correct_trials.select('rt').mean());
        } else {
          var nj_trials = jsPsych.data.get().filter({test_part: 'nj_test'});
          var nj_correct_trials = nj_trials.filter({correct: true});
          var nj_accuracy = Math.round(nj_correct_trials.count() / nj_trials.count() * 100);
          var nj_rt = Math.round(nj_correct_trials.select('rt').mean());
        }


        return "<p>You responded correctly on "+ob_accuracy+"% of the oddball trials.</p>"+
        "<p>Your average response time was "+ob_rt+"ms.</p>"+
        "<p>You responded correctly on "+ct_accuracy+"% of the single-item trials.</p>"+
        "<p>Your average response time was "+ct_rt+"ms.</p>"+
        "<p>Press any key to complete the experiment. Thank you!</p>";
      }
    };
    //timeline.push(debrief_block);

    /* start the experiment */
    jsPsych.init({timeline: timeline, display_element: 'target'});

  </script>
</html>
